openapi: 3.0.3
info:
  title: TeamFlow API
  version: 0.3.0
  description: >
    TeamFlow のコアAPI仕様 (Auth / Projects / Tasks / Members / Invitations / Comments / Labels)。
    認証は cookie ベース (sid) を前提とする。

servers:
  - url: https://api.teamflow.example.com
    description: Production (仮)
  - url: http://localhost:3000
    description: Local dev (Next.js)

paths:
  # ===========================
  # Auth
  # ===========================
  /api/auth/signup:
    post:
      summary: メール＋パスワードでユーザー新規登録
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthSignupRequest'
      responses:
        '201':
          description: ユーザー登録成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: バリデーションエラーなど
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: email が既に存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      summary: メール＋パスワードでログイン
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: ログイン成功（クッキーにセッションID付与）
          headers:
            Set-Cookie:
              description: sid クッキー（HttpOnly, Secure）
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: 認証失敗
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      summary: ログアウト（セッション無効化）
      tags: [Auth]
      security:
        - cookieAuth: []
      responses:
        '204':
          description: ログアウト成功（クッキー破棄）

  /api/auth/refresh:
    post:
      summary: アクセストークン／セッションの更新
      tags: [Auth]
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 更新後のユーザー情報（必要に応じて）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: リフレッシュ不可
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/me:
    get:
      summary: 現在ログイン中のユーザー情報取得
      tags: [Auth]
      security:
        - cookieAuth: []
      responses:
        '200':
          description: ログインユーザー情報
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================
  # Projects
  # ===========================
  /api/projects:
    get:
      summary: 自分が所属するプロジェクト一覧
      tags: [Projects]
      security:
        - cookieAuth: []
      responses:
        '200':
          description: プロジェクト一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
    post:
      summary: 新規プロジェクト作成
      tags: [Projects]
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectCreateRequest'
      responses:
        '201':
          description: 作成されたプロジェクト
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 内部サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/projects/{projectId}:
    get:
      summary: プロジェクト詳細取得
      description: >
        公開プロジェクトであればゲスト閲覧を許可する想定。
        認証要否は今後の方針により調整。
      tags: [Projects]
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: プロジェクト詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: 見つからない or 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    patch:
      summary: プロジェクトの更新
      description: owner / admin のみ許可
      tags: [Projects]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectUpdateRequest'
      responses:
        '200':
          description: 更新後のプロジェクト
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: プロジェクトが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 内部サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================
  # Project Members & Invitations
  # ===========================
  /api/projects/{projectId}/members:
    get:
      summary: プロジェクトメンバー一覧
      tags: [Members]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: メンバー一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProjectMember'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: 既存ユーザーをメンバーとして追加
      description: email または userId で追加する想定
      tags: [Members]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectMemberAddRequest'
      responses:
        '201':
          description: 追加されたメンバー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMember'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/projects/{projectId}/members/{userId}:
    patch:
      summary: メンバーのロール変更
      tags: [Members]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectMemberUpdateRoleRequest'
      responses:
        '200':
          description: 更新後のメンバー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMember'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: メンバー削除
      tags: [Members]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 削除成功
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/projects/{projectId}/invitations:
    post:
      summary: 招待リンク or 招待メールの発行
      tags: [Invitations]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvitationCreateRequest'
      responses:
        '201':
          description: 作成された招待
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invitation'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/invitations/{token}:
    get:
      summary: 招待トークンの状態確認
      tags: [Invitations]
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 有効な招待
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invitation'
        '404':
          description: 無効 or 期限切れ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: 招待の受諾（メンバーとして参加）
      tags: [Invitations]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '201':
          description: 参加後のプロジェクトメンバー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMember'
        '400':
          description: 既に参加済みなど
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 無効 or 期限切れ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================
  # Tasks
  # ===========================
  /api/projects/{projectId}/tasks:
    get:
      summary: プロジェクト内タスク一覧（カンバン用）
      tags: [Tasks]
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
        # --- Filters ---
        - name: status
          in: query
          required: false
          description: >
            ステータスでフィルタ。カンマ区切りで複数指定可能（例: status=todo,in_progress）。
            推奨値: todo / in_progress / done。
            互換のため doing も受け付ける（doing は in_progress に正規化される想定）。
          schema:
            type: string
          style: form
          explode: false
        - name: assigneeId
          in: query
          required: false
          description: 担当者のユーザーIDで絞り込み（UUID）。
          schema:
            type: string
            format: uuid
        - name: priority
          in: query
          required: false
          description: >
            優先度でフィルタ。カンマ区切りで複数指定可能（例: priority=high,medium）。
            推奨値: low / medium / high。
          schema:
            type: string
          style: form
          explode: false
        - name: dueDateFrom
          in: query
          required: false
          description: 期限の開始日（YYYY-MM-DD形式）。この日以降のタスクを取得
          schema:
            type: string
            format: date
        - name: dueDateTo
          in: query
          required: false
          description: 期限の終了日（YYYY-MM-DD形式）。この日以前のタスクを取得
          schema:
            type: string
            format: date
        - name: q
          in: query
          required: false
          description: 検索クエリ（MVPはタイトルの部分一致を想定）
          schema:
            type: string
            minLength: 1
        # --- Sorting ---
        - name: sort
          in: query
          required: false
          description: >
            ソート順を指定。形式: sort=-priority,createdAt（- はDESC、無印はASC）。
            使用可能キー: sortOrder, createdAt, updatedAt, dueDate, priority。
            dueDate の null 値は最後に寄せる（ASC時は最後、DESC時は最初）。
            priority は辞書順ではなく業務順（high > medium > low）でソートされる。
          schema:
            type: string
            example: "-priority,createdAt"
        # --- Safety / Limit ---
        - name: limit
          in: query
          required: false
          description: 取得件数の上限。未指定時は200、最大200件まで取得可能
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 200
        - name: cursor
          in: query
          required: false
          description: >
            Cursor-based pagination 用のカーソル（opaque）。
            指定した場合、サーバが返した nextCursor をそのまま次リクエストに渡す。
          schema:
            type: string
      responses:
        '200':
          description: タスク一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  tasks:
                    type: array
                    items:
                      $ref: '#/components/schemas/Task'
                  page:
                    type: object
                    nullable: true
                    description: ページング情報（cursor導入時に利用）
                    properties:
                      nextCursor:
                        type: string
                        nullable: true
                      limit:
                        type: integer
                required: [tasks]
        '400':
          description: クエリパラメータのバリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: タスク作成
      tags: [Tasks]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCreateRequest'
      responses:
        '201':
          description: 作成されたタスク
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: プロジェクトに対する権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 内部サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/tasks/{taskId}:
    get:
      summary: タスク詳細取得
      tags: [Tasks]
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: タスク詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '404':
          description: タスクが存在しない or 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    patch:
      summary: タスク更新（タイトル/説明/ステータス/期限など）
      tags: [Tasks]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskUpdateRequest'
      responses:
        '200':
          description: 更新後のタスク
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: タスクが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/tasks/{taskId}/move:
    patch:
      summary: カンバン上でのタスク移動（status + sort_order 更新）
      tags: [Tasks]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskMoveRequest'
      responses:
        '200':
          description: 移動後のタスク
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: 不正なステータス or 並び順
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: タスクが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================
  # Comments
  # ===========================
  /api/tasks/{taskId}/comments:
    get:
      summary: タスクのコメント一覧
      tags: [Comments]
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: コメント一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: '#/components/schemas/TaskComment'
    post:
      summary: コメント追加
      tags: [Comments]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCommentCreateRequest'
      responses:
        '201':
          description: 作成されたコメント
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskComment'

  /api/comments/{commentId}:
    patch:
      summary: コメント編集（自分のものだけ）
      tags: [Comments]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: commentId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCommentUpdateRequest'
      responses:
        '200':
          description: 更新後のコメント
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskComment'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: コメント削除
      tags: [Comments]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: commentId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 削除成功
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================
  # Labels
  # ===========================
  /api/projects/{projectId}/labels:
    get:
      summary: プロジェクトのラベル一覧
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ラベル一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  labels:
                    type: array
                    items:
                      $ref: '#/components/schemas/TaskLabel'
    post:
      summary: ラベル作成
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskLabelCreateRequest'
      responses:
        '201':
          description: 作成されたラベル
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskLabel'

  /api/projects/{projectId}/labels/{labelId}:
    patch:
      summary: ラベル更新（名前・色）
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: labelId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskLabelUpdateRequest'
      responses:
        '200':
          description: 更新後のラベル
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskLabel'
    delete:
      summary: ラベル削除
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: labelId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 削除成功

  /api/tasks/{taskId}/labels/{labelId}:
    post:
      summary: タスクにラベル付与
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: labelId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 付与成功
    delete:
      summary: タスクからラベル解除
      tags: [Labels]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: labelId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 解除成功

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sid

  schemas:
    # -------- 共通 --------
    ValidationIssue:
      type: object
      description: バリデーションエラーの1件分（どの入力のどこが問題か）
      properties:
        location:
          type: string
          description: エラー発生箇所
          enum: [query, path, body]
        field:
          type: string
          description: >
            対象フィールド名（例: status, priority, sort, dueDateFrom）
        code:
          type: string
          description: 機械判定用のエラーコード
          example: INVALID_ENUM
        message:
          type: string
          description: >
            人間向けメッセージ（修正すべき内容が分かる文言）
        rejectedValue:
          nullable: true
          description: >
            受け付けられなかった入力値（出せる場合のみ）
      required: [location, field, code, message]

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: >
            エラー種別コード（例: VALIDATION_ERROR）
        message:
          type: string
          description: 人間向けメッセージ
        details:
          type: object
          description: フィールド単位の詳細エラーなど
          properties:
            issues:
              type: array
              description: バリデーションエラーの詳細（複数件）
              items:
                $ref: '#/components/schemas/ValidationIssue'
      required: [error, message]

    # -------- User --------
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        avatarUrl:
          type: string
          nullable: true
      required: [id, name, email]

    # -------- Auth --------
    AuthSignupRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
      required: [name, email, password]

    AuthLoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required: [email, password]

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'

    # -------- Project --------
    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ownerId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, archived]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, ownerId, name, status, createdAt, updatedAt]

    ProjectCreateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
      required: [name]

    ProjectUpdateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, archived]

    # -------- Task --------
    Task:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [todo, doing, in_progress, done]
        priority:
          type: string
          enum: [low, medium, high]
        assigneeId:
          type: string
          format: uuid
          nullable: true
        dueDate:
          type: string
          format: date-time
          nullable: true
        sortOrder:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - projectId
        - title
        - status
        - priority
        - sortOrder
        - createdAt
        - updatedAt

    TaskCreateRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [todo, doing, in_progress, done]
          default: todo
        priority:
          type: string
          enum: [low, medium, high]
          default: medium
        assigneeId:
          type: string
          format: uuid
        dueDate:
          type: string
          format: date-time
      required: [title]

    TaskUpdateRequest:
      type: object
      minProperties: 1
      description: PATCH /api/tasks/{taskId} のリクエストボディ。すべてのフィールドは任意（optional）。更新したいフィールドのみを指定する。少なくとも1つのフィールドは必須。
      properties:
        title:
          type: string
          description: タスクのタイトル。空文字または空白のみの場合は400エラー。
        description:
          type: string
          nullable: true
          description: タスクの説明。
        status:
          type: string
          enum: [todo, doing, in_progress, done]
          description: タスクのステータス。正式な値は todo / in_progress / done。"doing" が指定された場合は互換のため "in_progress" に正規化される。
        priority:
          type: string
          enum: [low, medium, high]
          description: タスクの優先度。
        assigneeId:
          type: string
          format: uuid
          nullable: true
          description: 担当者のユーザーID。
        dueDate:
          type: string
          format: date-time
          nullable: true
          description: 期限日時（RFC3339形式）。

    TaskMoveRequest:
      type: object
      properties:
        status:
          type: string
          enum: [todo, doing, in_progress, done]
        sortOrder:
          type: integer
          description: 新しいカンバン内の並び順
      required: [status, sortOrder]

    # -------- Members --------
    ProjectMember:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        role:
          type: string
          enum: [owner, admin, member]
        joinedAt:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/User'
      required: [projectId, userId, role, joinedAt]

    ProjectMemberAddRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        userId:
          type: string
          format: uuid
        role:
          type: string
          enum: [admin, member]
      description: email または userId のどちらか必須

    ProjectMemberUpdateRoleRequest:
      type: object
      properties:
        role:
          type: string
          enum: [owner, admin, member]
      required: [role]

    # -------- Invitations --------
    Invitation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        email:
          type: string
          format: email
        token:
          type: string
        role:
          type: string
          enum: [admin, member]
        expiresAt:
          type: string
          format: date-time
        acceptedAt:
          type: string
          format: date-time
          nullable: true
      required:
        - id
        - projectId
        - email
        - token
        - role
        - expiresAt

    InvitationCreateRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, member]
      required: [email, role]

    # -------- Comments --------
    TaskComment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        taskId:
          type: string
          format: uuid
        authorId:
          type: string
          format: uuid
        body:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        author:
          $ref: '#/components/schemas/User'
      required:
        - id
        - taskId
        - authorId
        - body
        - createdAt
        - updatedAt

    TaskCommentCreateRequest:
      type: object
      properties:
        body:
          type: string
      required: [body]

    TaskCommentUpdateRequest:
      type: object
      properties:
        body:
          type: string
      required: [body]

    # -------- Labels --------
    TaskLabel:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        name:
          type: string
        color:
          type: string
      required: [id, projectId, name, color]

    TaskLabelCreateRequest:
      type: object
      properties:
        name:
          type: string
        color:
          type: string
      required: [name, color]

    TaskLabelUpdateRequest:
      type: object
      properties:
        name:
          type: string
        color:
          type: string
